<?php
/*
CREATE TABLES IN THE WPDB
Checks whether the requred tables exists or no.
If the table isn't present a new table is created.
Source of inspiration: http://jacobschatz.com/?p=23 - however the versioncheck is disabled by now.
The code is basically the same for other database tables.
*/

include('config.php');

check_Kbn_database(); // Is the table present?

function check_Kbn_database()
{
	$table_name = "KbnLog";
	if($wpdb->get_var("SHOW TABLES LIKE '$table_name'") != $table_name)
	{
		$sql = "CREATE TABLE " . $table_name . " (

			`Id` int(11) NOT NULL AUTO_INCREMENT,
			`What` text NOT NULL,
			`KbnNotesId` int(11) NOT NULL,
			`KbnStatesId` int(11) NOT NULL,
			`KbnProjectsId` int(11) NOT NULL,
			`KbnNotesName` text NOT NULL,
			`Date` date NOT NULL,
			PRIMARY KEY (`Id`),
			UNIQUE KEY `Id` (`Id`)
			);";
 
		require_once(ABSPATH . 'wp-admin/includes/upgrade.php'); // henter upgrade klassen
		dbDelta($sql);
 
// insert test values into the DB

	$wpdb->insert(
			'KbnLog',
			array(
				'Id' => NULL,
				'What' => 'Test log',
				'KbnNotesId' => 1,
				'KbnStatesId' => 1,
				'KbnProjectsId' => 1,
				'KbnNotesName' => 'Test Log Entry',
				'Date' => date('Y-m-d'),

			),
			array('%d', '%s', '%d', '%d', '%d', '%s', '%s'  )

		);
	} // if ends
	else {
		return "OK: the table KbnLog found.";
	}
}

?>
